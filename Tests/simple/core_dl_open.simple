import "Core.DL" as DL
import "IO"
Color :: artifact {
  r : i8;
  g : i8;
  b : i8;
  a : i8;
}
extern ffi.simple_add_i32 : i32 (a : i32, b : i32)
extern ffi.simple_add_i8 : i8 (a : i8, b : i8)
extern ffi.simple_add_i16 : i16 (a : i16, b : i16)
extern ffi.simple_add_u8 : u8 (a : u8, b : u8)
extern ffi.simple_add_u16 : u16 (a : u16, b : u16)
extern ffi.simple_add_u32 : u32 (a : u32, b : u32)
extern ffi.simple_add_u64 : u64 (a : u64, b : u64)
extern ffi.simple_bool_and : bool (a : bool, b : bool)
extern ffi.simple_char_max : char (a : char, b : char)
extern ffi.simple_hello : string ()
extern ffi.simple_inc_i32 : i32 (a : i32)
extern ffi.simple_mix_i32_f64 : f64 (a : i32, b : f64)
extern ffi.simple_strlen_cstr : i32 (text : string)
extern ffi.simple_echo : string (text : string)
extern ffi.simple_sink_i32 : void (value : i32)
extern ffi.simple_color_sum : i32 (color : Color)
extern ffi.simple_color_make : Color (r : u8, g : u8, b : u8, a : u8)

main : i32 () {
  lib : i64 = DL.Open("Tests/ffi/libsimpleffi.so", ffi);
  sum : i32 = 0;
  msg : string = "";
  if lib == 0 {
    IO.println(DL.LastError())
    return 0
  }
  sum = lib.simple_add_i32(64, 64);
  IO.println(sum);
  IO.println(lib.simple_add_i8(60, 7));
  IO.println(lib.simple_add_i16(200, 44));
  IO.println(lib.simple_add_u8(100, 23));
  IO.println(lib.simple_add_u16(400, 23));
  IO.println(lib.simple_add_u32(1000, 23));
  IO.println(lib.simple_add_u64(5000, 23));
  IO.println(lib.simple_bool_and(true, true));
  IO.println(lib.simple_char_max('A', 'Z'));
  msg = lib.simple_hello();
  IO.println(msg);
  IO.println(lib.simple_inc_i32(41));
  IO.println(lib.simple_mix_i32_f64(3, 0.5));
  IO.println(lib.simple_strlen_cstr("hello"));
  IO.println(lib.simple_echo("echo"));
  lib.simple_sink_i32(1234);
  c : Color = { .r = 1, .g = 2, .b = 3, .a = 4 };
  IO.println(lib.simple_color_sum(c));
  c2 : Color = lib.simple_color_make(5, 6, 7, 8);
  IO.println(lib.simple_color_sum(c2));
  DL.Close(lib)
  return 1
}
