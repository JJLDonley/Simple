import "Core.DL" as DL
import "IO"

Color :: artifact {
    r: u8
    g: u8
    b: u8
    a: u8
}

extern ffi.InitWindow: void (width: i32, height: i32, title: string)
extern ffi.CloseWindow: void ()
extern ffi.WindowShouldClose: bool ()
extern ffi.BeginDrawing: void ()
extern ffi.EndDrawing: void ()
extern ffi.ClearBackground: void (color: i32)
extern ffi.DrawText: void (text: string, x: i32, y: i32, size: i32, tint: i32)

lib :: i64 = DL.Open("Tests/ffi/libraylib.so", ffi)

InitWindow : void (width: i32, height: i32, title: string) {
    lib.InitWindow(width, height, title)
}

CloseWindow : void () {
    lib.CloseWindow()
}

WindowShouldClose : bool () {
    return lib.WindowShouldClose()
}

BeginDrawing : void () {
    lib.BeginDrawing()
}

EndDrawing : void () {
    lib.EndDrawing()
}

ClearBackground : void (color: i32) {
    lib.ClearBackground(color)
}

DrawText : void (text: string, x: i32, y: i32, size: i32, tint: i32) {
    lib.DrawText(text, x, y, size, tint)
}

main : i32 () {
    
    InitWindow(1280, 720, "SimpleVM + Raylib")

    // Packed as r | (g << 8) | (b << 16) | (a << 24)
    bg   :: i32 = -14937068
    tint :: i32 = -657931

    while !WindowShouldClose() {
        BeginDrawing()
        ClearBackground(bg)
        DrawText("Hello from SimpleVM + raylib (FFI)!", 40, 40, 30, tint)
        EndDrawing()
    }

    CloseWindow()
}
