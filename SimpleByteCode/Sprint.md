# Sprint Log - Simple VM

## Notes
- This log must record every VM-related change going forward.

## 2026-01-29
- Created SBC design docs in `SimpleByteCode/` (headers, encoding, sections, metadata, opcodes, rules, debug, runtime).
- Implemented initial VM skeleton in `SimpleByteCode/vm/`.
- Added loader for SBC header/sections/tables.
- Added basic verifier (instruction boundary + simple stack checks).
- Added interpreter core with minimal opcode support (i32/bool, locals, calls, control flow).
- Added `build.sh` using g++ for local build.
- Added VM README.
- Added implementation plan `SimpleByteCode/Implementation.md`.
- Removed committed VM binary `SimpleByteCode/vm/bin/simplevm`.
- Expanded loader validation (section IDs, bounds, table index checks).
- Expanded verifier checks for locals/globals and call signature validation.
- Added VM test harness and initial bytecode test (CONST_I32 + ADD_I32).
- Updated build script to compile test binary.
- Added `SimpleByteCode/vm/.gitignore` to prevent committing built binaries.
- Implemented global storage in VM with LOAD_GLOBAL/STORE_GLOBAL support.
- Added global read/write test to the VM test harness.
- Updated VM build script to auto-run tests after build.
- Routed VM execution through verifier by default; added `--no-verify` option path.
- Implemented stack ops (POP/DUP/DUP2/SWAP/ROT) and small const variants (I8/I16/U8/U16).
- Added tests for DUP, SWAP, and ROT behaviors.
- Added full i32 comparison opcodes (EQ/NE/LT/LE/GT/GE) and branch coverage tests.
- Fixed comparison test to return i32 exit code instead of bool.
- Updated test harness to print per-test results.
- Added MOD_I32 opcode and tests for POP, DUP2, MOD, and boolean ops with branching.
- Added local load/store and loop execution tests; added JMP bounds checks.
- Added heap object scaffolding and reference opcodes (ConstNull/NewObject/IsNull/RefEq/RefNe) with tests.
- Added array opcodes (NEW_ARRAY/ARRAY_LEN/ARRAY_GET_I32/ARRAY_SET_I32) with VM support and tests.
- Added list opcodes (NEW_LIST/LIST_LEN/LIST_GET_I32/LIST_SET_I32/LIST_PUSH_I32/LIST_POP_I32) with VM support and tests.
- Fixed list and core test local-count mismatches after adding list support.
- Added string ops (CONST_STRING/STRING_LEN/STRING_CONCAT) with const pool support and tests.
- Added basic GC root marking/sweep pass and a GC smoke test.
- Added field ops (NEW_OBJECT/LOAD_FIELD/STORE_FIELD/TYPEOF) with tests and custom type/field tables.
- Fixed field test stack order for TYPEOF.
- Added verifier checks for object/field/string indices and a negative field-id verify test.
- Added verifier coverage for bad CONST_STRING indices.
- Added negative runtime tests for array bounds and list pop underflow.
- Added tests for ARRAY_LEN, LIST_LEN, and list overflow trapping.
- Added basic type-stack verification and a bad-type verifier test.
- Added CallCheck opcode and verifier/type-stack support for it.
- Added merge-point type validation and a bad-merge verifier test.
- Fixed verifier control-flow merge handling for non-fallthrough ops (JMP/RET/etc.).
- Added ConstU32/ConstChar support and debug/intrinsic op handling with tests for constants, debug no-ops, and intrinsic/syscall traps.
- Implemented CALL_INDIRECT and TAILCALL execution with verifier stack tracking and added multi-function tests.
- Added list insert/remove/clear and string get/slice opcodes with verifier checks, runtime support, and tests.
- Added trap tests for list insert/remove and string get/slice bounds errors.
- Added CALL_INDIRECT verify/trap tests for arg mismatch, bad function index, and invalid runtime function value.
- Added verifier rejection tests for CALL and TAILCALL arg-count mismatches.
- Added ConstI64/ConstU64/ConstF32/ConstF64 runtime handling with new tests.
- Added I64 arithmetic and comparison opcodes with verifier support and tests.
- Added F32/F64 arithmetic and comparison opcodes with verifier support and tests.
- Added CONST_I128/CONST_U128 handling via const pool blobs with verifier support and tests.
- Added numeric conversion opcodes (int/float) with verifier checks, runtime support, and tests.
- Added conversion misuse tests: verifier rejection and runtime trap (no-verify) for bad conversion types.
- Added return-type verification (void vs typed) with a negative test for missing return value.
- Adjusted trap test builders and field type metadata to satisfy return-type verification (HALT for trap paths, I32 ret type).
- Added U32/U64 arithmetic/compare opcodes with verifier/runtime support and tests; added negative CONST_I128/U128 tests; extended return type mapping for bool.
- Added I32/I64 bitwise ops with tests, plus a return-ref verification test.
- Added unsigned edge-case tests for U32/U64 div-by-zero and overflow wrap behavior.
- Added negative tests for bitwise ops (verify failure and no-verify runtime trap).
- Added unsigned compare min/max ordering tests for U32/U64.
- Added shift masking tests for large shift counts on I32/I64.
- Added unsigned-op wrong-type tests (verify failures + no-verify runtime traps).
- Added verifier tracking for uninitialized locals with a negative test.
- Updated bad_call_indirect_type test to avoid uninitialized local under new verifier rules.
- Added verifier enforcement for function stack_max with a negative test.
- Added verifier negative test for jump targets landing mid-instruction.
- Added verifier negative test for out-of-bounds jump targets and a positive jump-to-end test.
- Allowed jump targets at function end boundary in verifier.
- Added unsigned compare boundary tests for U32/U64 max vs zero and equality.
- Added verifier negative test for signature param_count exceeding local_count.
- Added verifier tracking for uninitialized globals with a negative test.
- Updated bad_call_indirect_type test to use initialized global under new verifier rule.
- Added loader validation for global init const ids with a negative load test.
- Tightened const pool validation for string null-termination and 16-byte I128/U128 blobs with load-time tests.
- Added positive load tests for valid CONST_STRING and I128 blob lengths.
- Added runtime initialization for globals from const pool (string/f32/f64) with a string init test.
- Added global init tests for F32/F64 const pool values.
- Added loader validation for field offsets against type size with a negative load test.
- Added loader validation for field size bounds with a negative load test.
- Added loader validation for TYPE const ids with a negative load test.
- Added runtime trap test for unsupported TYPE global init consts.
- Added loader validation for signature call_conv and method flags with negative load tests.
- Added loader validation for header flags with a negative load test.
- Added loader validation for field offset alignment with a negative load test.
- Added loader validation for stack_max > 0 with a negative load test.
- Added loader validation for entry_method_id presence in functions table with a negative load test.
- Added loader validation for function code_offset matching method code_offset with a negative load test.
- Added loader validation for duplicate method code offsets with a negative load test.
- Added loader validation for overlapping function code ranges with a negative load test.
- Added no-verify runtime trap test for out-of-bounds JMP.
- Added no-verify runtime trap tests for out-of-bounds JmpTrue/JmpFalse.
- Wired packed signature param type lists into loader/verifier with a negative CALL param type test.
- Added negative verifier tests for CALL_INDIRECT and TAILCALL param type mismatches.
- Added loader negative tests for missing/out-of-range signature param type lists.
- Added loader negative test for misaligned signature param type list size.
- Added loader negative test for signature param type id out of range.
- Added positive CALL/CALL_INDIRECT tests for typed parameters.
- Added loader negative test for truncated signature table size.
- Added loader negative test for misaligned section offsets.
- Added loader negative test for overlapping sections.
- Added loader negative test for unknown section ids.
- Added loader negative test for duplicate section ids.
- Added loader negative test for section table out-of-bounds via header count.
- Added loader negative test for invalid header endianness.
- Added CMake + Windows build scripts for cross-platform builds.
- Added loader negative test for unsupported header flags.
- Added loader negative tests for bad magic/version/reserved, section count/offset issues, and table size mismatches.
- Added loader negative tests for invalid type/field/global/function/method references.
- Added loader negative tests for missing CODE/FUNCTIONS sections.
- Added loader negative tests for const pool string/i128 offsets and truncated F64.
- Added verifier tests for merge height mismatch and stack underflow.
- Added verifier test for merge type mismatch between ref and i32.
- Added verifier tests for string op type mismatches.
- Added verifier type-mismatch tests for ref ops, field ops, array/list ops, and STRING_LEN.
- Added verifier type-mismatch tests for BOOL ops and JMP condition.
- Added verifier type-mismatch tests for array/list ops with wrong container types.
- Added verifier test for JMP_FALSE non-bool condition.
- Added verifier tests for STRING_GET_CHAR and STRING_SLICE index type mismatches.
- Added verifier tests for REF_EQ/REF_NE mixed ref vs non-ref operands.
- Added verifier tests for mixed BOOL_AND/BOOL_OR operand types.
- Added runtime trap tests for ARRAY_SET and LIST_GET/LIST_SET out-of-bounds indices.
- Added runtime trap tests for negative indices in ARRAY_GET/ARRAY_SET and LIST_GET/LIST_SET.
- Added runtime trap tests for negative indices in STRING_GET_CHAR and STRING_SLICE.
- Added runtime trap tests for null refs across array/list/string ops.
- Implemented heap free-list reuse with alive tracking; added heap reuse test.
- Added NEW_CLOSURE execution + verifier validation, with positive and negative tests.
- Added closure upvalue marking in GC and a heap closure mark test.
- Added GC stress test to validate mark/sweep behavior on many objects.
- Added VM-level GC stress test with allocation loop.
- Implemented LOAD_UPVALUE/STORE_UPVALUE with closure-aware CALL_INDIRECT, plus tests.
- NEW_CLOSURE now captures upvalues from stack; added verifier/type tests for upvalues.
- Added upvalue capture test for non-null ref objects.
- Added upvalue capture ordering test for multiple captures.
- Added NEG_I32/NEG_I64 opcodes with verifier/runtime support and tests.
- Added NEG_F32/NEG_F64 opcodes with verifier/runtime support and tests.
- Added INC/DEC opcodes for I32/I64 with verifier/runtime support and tests.
- Added INC/DEC opcodes for F32/F64 with verifier/runtime support and tests.
- Added INC/DEC opcodes for U32/U64 with verifier/runtime support and tests.
- Added U32/U64 INC/DEC wraparound tests at numeric bounds.
- Added INC/DEC opcodes for I8/I16/U8/U16 with verifier/runtime support and tests.
- Added NEG opcodes for I8/I16/U8/U16 with verifier/runtime support and tests.
- Added JMP_TABLE opcode with const pool jump table entries, verifier/VM support, and tests.
- Added basic JIT tier tracking scaffolding with hotness thresholds and a tiering test.
- Exposed per-function call counts in ExecResult and validated counts in the JIT tier test.
- Added JMP_TABLE runtime trap tests for bad kind, malformed blob, and out-of-bounds targets.
- Added NEG I8/I16 wraparound boundary tests.
- Added NEG U32/U64 opcodes with verifier/runtime support and tests.
- Added NEG U32/U64 wraparound boundary tests.
- Added JIT tier stubs in call paths (Tier0/Tier1 placeholder hooks).
- Added JMP_TABLE default-target boundary tests (jump to end/start).
- Added NEG U8/U16 wraparound boundary tests.
- Added per-opcode hotness counters in ExecResult with JIT test coverage.
- Added JMP_TABLE empty-table test (default target when count=0).
